version: '3'
services:
  vault:
    image: "vault"
    hostname: "vault"
    entrypoint: vault server -dev -config=/etc/vault/config.hcl
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: "root"
      VAULT_DEV_LISTEN_ADDRESS: "0.0.0.0:8200"
      VAULT_ADDR: "http://localhost:8200"
    ports:
      - "8200:8200"
    volumes:
      - ./vault/config:/etc/vault:ro
      - ./vault/plugins:/var/vault/plugins

  vault-init:
    build:
      dockerfile: Dockerfile.vault-init
      context: .
    depends_on:
      - vault
    links:
      - "vault:vault"
    environment:
      VAULT_PLUGIN_DIR: "/var/vault/plugins"
      VAULT_ADDR: "http://vault:8200"
      VAULT_TOKEN: "root"
    volumes:
      - ./vault/entrypoint:/usr/local/bin:ro
      - ./vault/plugins:/var/vault/plugins:ro
